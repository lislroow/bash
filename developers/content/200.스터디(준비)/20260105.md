+++
title = "2026.01.05"
url = "/ready-for-study/20260105"

[menu.main]
  identifier = "20260105"
  name = "2026.01.05"
  weight = 20260105
  parent = "ready-for-study"
+++

## 2. develop.el10 구성 (계속)
### 2.2 caddy 구성 (계속)
#### 4) self-signed 인증서 적용 (생성 포함)

{{< embed "20260105/20260105-certmgr.sh.md" >}}

<details>
<summary>self-signed 인증서 생성</summary>

```sh
- (ca 인증서 생성) `./certmgr.sh create ca`
  - el10CA.key
  - el10CA.crt  # caddy 적용 + 클라이언트 추가
- (서버 인증서 생성) `./certmgr.sh create server code.develop`
  - code.develop.el10.key # caddy 적용
  - code.develop.el10.crt # caddy 적용
  - code.develop.el10.csr
- (클라이언트 인증서 생성) `./certmgr.sh create client`
  - client-el10.key
  - client-el10.crt
  - client-el10.p12  # 클라이언트 추가
  - client-el10.csr
```
</details>

<details>
<summary>self-signed 인증서 → caddy 적용 + 클라이언트 추가</summary>

{{< code-compare leftLang="nginx" rightLang="sh" leftTitle="caddy 적용" centerTitle="" rightTitle="클라이언트 추가" >}}
# /etc/caddy/Caddyfile
code.develop.el10:443 {
  # 실제 적용 시 /app/certs/server/ 경로 붙일 것
  tls code.develop.el10.crt code.develop.el10.key {
    client_auth {
      mode require_and_verify
      trust_pool file /app/certs/ca/el10CA.crt
    }
  }
  reverse_proxy localhost:8080
}
---
# 클라이언트 인증서 추가
- `el10CA.crt` 추가
  1) el10CA.crt 더블클릭
  2) `(중요) 저장소 위치: '현재 사용자' ('로컬 컴퓨터' 아님)`
  3) '인증서 종류를 기준으로 인증서 저장소를 자동으로 선택'
  - (마침) → (Win + R) certmgr.msc → '신뢰..루트' 확인 필수
- `client-el10.p12` 추가
  1) client-el10.p12 더블클릭
  2) `(중요) 저장소 위치: '현재 사용자' ('로컬 컴퓨터' 아님)`
  3) (client-el10.p12 생성 시 설정 했던) 암호 입력
  4) '인증서 종류를 기준으로 인증서 저장소를 자동으로 선택'
  - (마침) → (Win + R) certmgr.msc → 개인용 확인 필수

- `현재 사용자`에 있어야 chrome 에서 읽어들임
{{< /code-compare >}}
</details>

#### 5) 개인 도메인 인증서 적용

1. 개인 도메인 준비 (가비아 → dlog.my 구매)
1. 가비아: dlog.my 도메인 → 도메인 관리 → code.dlog.my 공유기IP 추가
1. 공유기: Port Forwarding 설정 → 외부IP:443 → 내부IP:443
1. `vm 호스트: Port Forwarding 설정` → vm호스트:443 → vm게스트:443
1. `vm 게스트: caddy 가상호스트 설정` → (caddy 재시작) → 자동으로 letsencrypt 인증서 발급 시도 → `letsencrypt 발급 조건 충족 시 발급 완료`

<details>
<summary>vm 호스트: Port Forwarding 설정</summary>

```powershell
> netsh interface portproxy add v4tov4 listenport=443 listenaddress=0.0.0.0 connectaddress=172.28.200.240 connectport=443
```
</details>

<details>
<summary>vm 게스트: caddy 가상호스트 설정</summary>

```nginx
# /etc/caddy/Caddyfile
{
  email myeonggu.kim@kakao.com
}

code.dlog.my:443 {
  tls {
    client_auth {
      mode require_and_verify
      trust_pool file /app/certs/ca/el10CA.crt
    }
  }
  reverse_proxy localhost:8080
}
```
</details>

{{< embed "20260105/20260105-caddy-letsencrypt.md" >}}
